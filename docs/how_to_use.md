# Threads Auto Poster 使い方ガイド

## 前提条件

- ✅ App ID と App Secret を `.env` に設定済み
- ✅ Threadsアカウント所有
- ✅ Meta Developer アカウント作成済み

## ステップ1: アクセストークンの取得

### 1-1. 認証URLを取得

```bash
/home/koki/work/threads/venv/bin/python scripts/get_access_token.py
```

表示されたURLをブラウザで開く

### 1-2. Threadsで認証

1. ブラウザでThreadsにログイン
2. アプリの権限を承認
3. リダイレクト後のURL（`https://localhost/?code=...`）から `code=` の後の文字列をコピー

### 1-3. アクセストークンを取得

```bash
/home/koki/work/threads/venv/bin/python scripts/get_access_token.py <認証コード>
```

**出力例**:
```
✅ アクセストークン取得成功！
アクセストークン: THQVJxxx...
ユーザーID: 123456789
```

この情報を控えておく

## ステップ2: Reflexアプリの起動

```bash
/home/koki/work/threads/venv/bin/reflex run
```

ブラウザで `http://localhost:3000` にアクセス

## ステップ3: アカウント登録

1. `/accounts` ページに移動
2. 「アカウント追加」ボタンをクリック
3. 以下を入力:
   - **名前**: 任意の名前（例: マイアカウント）
   - **User ID**: ステップ1で取得した `user_id`
   - **アクセストークン**: ステップ1で取得した `access_token`
4. 「保存」をクリック

## ステップ4: 投稿グループ・投稿の作成

### 4-1. グループ作成

1. `/posts` ページに移動
2. 「グループ追加」ボタンをクリック
3. グループ名と説明を入力
4. 「作成」をクリック

### 4-2. 投稿テンプレート作成

1. 作成したグループを選択
2. 「投稿追加」ボタンをクリック
3. 以下を入力:
   - **メディアタイプ**: TEXT/IMAGE/VIDEO/CAROUSEL
   - **テキスト**: 投稿内容（500文字以内）
   - **メディアURL**: 画像/動画の場合はURL入力
4. 「作成」をクリック

## ステップ5: 投稿方法

### 方法A: 手動投稿

1. `/manual-post` ページに移動
2. 投稿先アカウントを選択（複数選択可能）
3. **直接入力タブ**:
   - メディアタイプ選択
   - テキスト入力
   - メディアURL入力（必要な場合）
   - 「投稿実行」をクリック
4. **テンプレートタブ**:
   - グループ選択
   - 投稿選択
   - 「投稿実行」をクリック

### 方法B: スケジュール投稿

1. `/schedules` ページに移動
2. アカウントを選択
3. スケジュールタイプを選択:
   - **FIXED**: 固定時刻（例: 10:00, 15:00, 20:00）
   - **RANDOM**: ランダム時刻（開始時刻、終了時刻、投稿回数を指定）
4. 「有効化」をチェック
5. 「作成」をクリック

スケジューラーが自動的に指定時刻に投稿を実行します。

## ステップ6: メトリクス確認

1. `/metrics` ページに移動
2. 成長ランキングを確認
3. アカウントを選択
4. 「メトリクス取得」をクリック
5. 視聴数、いいね、返信、リポスト、フォロワー数を確認

## トラブルシューティング

### アクセストークンエラー

**エラー**: `Access token expired`

**解決方法**:
- トークンは60日間有効
- 自動リフレッシュ機能が毎日午前3時に実行
- 手動で更新する場合は、アカウントを再登録

### 投稿エラー

**エラー**: `Daily posting limit reached`

**原因**: 250件/24時間の制限に達した

**解決方法**:
- 24時間待つ
- 別のアカウントを使用

### レート制限エラー

**エラー**: `Rate limit exceeded`

**解決方法**:
- 自動的にリトライされます（指数関数的バックオフ）
- しばらく待ってから再試行

## 投稿の流れ

```
1. メディアコンテナ作成
   ↓
2. 30秒待機（画像/動画の場合）
   ↓
3. 投稿公開
   ↓
4. 投稿履歴に記録
```

## ログの確認

```bash
# 今日のログを確認
tail -f logs/$(date +%Y%m%d).log

# エラーのみ確認
grep ERROR logs/$(date +%Y%m%d).log
```

## 重要な注意事項

1. **アクセストークン**: 必ず暗号化されて保存されます
2. **レート制限**: 250件/24時間（アカウント単位）
3. **トークン有効期限**: 60日間（自動更新）
4. **画像/動画**: 30秒の待機時間が必要
5. **メディアURL**: 公開アクセス可能なURLが必要

## よくある質問

### Q: 複数アカウントに同時投稿できますか？
A: はい、手動投稿ページで複数アカウントを選択できます。

### Q: 投稿を予約できますか？
A: はい、スケジュール設定で固定時刻またはランダム時刻を指定できます。

### Q: 投稿履歴は確認できますか？
A: データベースに記録されています。将来的にUI実装予定です。

### Q: トークンは安全ですか？
A: はい、Fernet暗号化で保護されています。

## サポート

問題が発生した場合:
1. ログファイルを確認（`logs/YYYYMMDD.log`）
2. エラーメッセージを確認
3. [requirements.md](./requirements.md) を参照
4. [handover.md](./handover.md) を参照

---

**最終更新**: 2025年1月
